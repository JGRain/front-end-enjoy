<template><div><p>本节我们主要讲述在世界中创建形状并添加刚体的过程。</p>
<!--more-->
<h1 id="添加刚体" tabindex="-1"><a class="header-anchor" href="#添加刚体" aria-hidden="true">#</a> 添加刚体</h1>
<h2 id="创建刚体" tabindex="-1"><a class="header-anchor" href="#创建刚体" aria-hidden="true">#</a> 创建刚体</h2>
<p>前面我们说过，box2d 中创建刚体、关节的过程类似于堆积木，由形状构成刚体，由刚体构成关节，稍微不同的地方是，这里的形状可以多次使用，其过程：
<code v-pre>形状 -&gt; 刚体 -&gt; 关节</code></p>
<p>这里我们首先创建各种形状，然后创建对应的刚体。</p>
<ul>
<li>创建圆形</li>
</ul>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">createBall</span><span class="token punctuation">(</span><span class="token parameter">world<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 创建圆形定义</span>
  <span class="token keyword">var</span> ballSd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">b2CircleDef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ballSd<span class="token punctuation">.</span>density <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span> <span class="token comment">// 设置密度</span>
  ballSd<span class="token punctuation">.</span>radius <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// 设置半径</span>
  ballSd<span class="token punctuation">.</span>restitution <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span> <span class="token comment">// 设置弹性</span>
  ballSd<span class="token punctuation">.</span>friction <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 设置摩擦因子</span>
  <span class="token keyword">var</span> ballBd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">b2BodyDef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建刚体定义</span>
  ballBd<span class="token punctuation">.</span><span class="token function">AddShape</span><span class="token punctuation">(</span>ballSd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加形状</span>
  ballBd<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>x <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span> y <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置位置</span>
  <span class="token keyword">return</span> world<span class="token punctuation">.</span><span class="token function">CreateBody</span><span class="token punctuation">(</span>ballBd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建并返回刚体</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>创建矩形</li>
</ul>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token comment">// 创建矩形刚体</span>
<span class="token keyword">function</span> <span class="token function">createBox</span><span class="token punctuation">(</span><span class="token parameter">world<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> userData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> boxSd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">b2BoxDef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个形状Shape，然后设置有关Shape的属性</span>
  boxSd<span class="token punctuation">.</span>extents<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>width <span class="token operator">||</span> <span class="token number">1200</span><span class="token punctuation">,</span> height <span class="token operator">||</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置矩形高、宽</span>
  boxSd<span class="token punctuation">.</span>density <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span> <span class="token comment">// 设置矩形的密度</span>
  boxSd<span class="token punctuation">.</span>userData <span class="token operator">=</span> userData<span class="token punctuation">;</span> <span class="token comment">// 传入图片数据</span>
  boxSd<span class="token punctuation">.</span>restitution <span class="token operator">=</span> <span class="token number">0.3</span><span class="token punctuation">;</span> <span class="token comment">//设置矩形的弹性</span>
  boxSd<span class="token punctuation">.</span>friction <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//设置矩形的摩擦因子，可以设置为0-1之间任意一个数，0表示光滑，1表示强摩擦</span>

  <span class="token keyword">var</span> boxBd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">b2BodyDef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建刚体定义</span>
  boxBd<span class="token punctuation">.</span><span class="token function">AddShape</span><span class="token punctuation">(</span>boxSd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加形状</span>
  boxBd<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>x <span class="token operator">||</span> <span class="token number">10</span><span class="token punctuation">,</span> y <span class="token operator">||</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置位置</span>
  <span class="token keyword">return</span> world<span class="token punctuation">.</span><span class="token function">CreateBody</span><span class="token punctuation">(</span>boxBd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建并返回刚体</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="添加刚体-1" tabindex="-1"><a class="header-anchor" href="#添加刚体-1" aria-hidden="true">#</a> 添加刚体</h2>
<p>利用上面创建刚体的函数，我们可以往世界中添加刚体：</p>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token keyword">var</span> ball1 <span class="token operator">=</span> <span class="token function">createBall</span><span class="token punctuation">(</span>world<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> ball2 <span class="token operator">=</span> <span class="token function">createBall</span><span class="token punctuation">(</span>world<span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> box1 <span class="token operator">=</span> <span class="token function">createBox</span><span class="token punctuation">(</span>world<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> box2 <span class="token operator">=</span> <span class="token function">createBox</span><span class="token punctuation">(</span>world<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="绘制刚体" tabindex="-1"><a class="header-anchor" href="#绘制刚体" aria-hidden="true">#</a> 绘制刚体</h2>
<p>我们可以通过添加绘制刚体的函数，在绘制世界时调用：</p>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token comment">// 从draw_world.js里面引用的绘画功能</span>
<span class="token keyword">function</span> <span class="token function">drawShape</span><span class="token punctuation">(</span><span class="token parameter">shape<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  context<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">"#003300"</span><span class="token punctuation">;</span>
  context<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>shape<span class="token punctuation">.</span>m_type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 绘制圆</span>
    <span class="token keyword">case</span> b2Shape<span class="token punctuation">.</span>e_circleShape<span class="token operator">:</span>
      <span class="token keyword">var</span> circle <span class="token operator">=</span> shape<span class="token punctuation">;</span>
      <span class="token keyword">var</span> pos <span class="token operator">=</span> circle<span class="token punctuation">.</span>m_position<span class="token punctuation">;</span>
      <span class="token keyword">var</span> r <span class="token operator">=</span> circle<span class="token punctuation">.</span>m_radius<span class="token punctuation">;</span>
      <span class="token keyword">var</span> segments <span class="token operator">=</span> <span class="token number">16.0</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> theta <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> dtheta <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2.0</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">/</span> segments<span class="token punctuation">;</span>
      <span class="token comment">// 画圆圈</span>
      context<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x <span class="token operator">+</span> r<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> segments<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">b2Vec2</span><span class="token punctuation">(</span>r <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>theta<span class="token punctuation">)</span><span class="token punctuation">,</span> r <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>theta<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> v <span class="token operator">=</span> b2Math<span class="token punctuation">.</span><span class="token function">AddVV</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> v<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        theta <span class="token operator">+=</span> dtheta<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      context<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x <span class="token operator">+</span> r<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 画半径</span>
      context<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> ax <span class="token operator">=</span> circle<span class="token punctuation">.</span>m_R<span class="token punctuation">.</span>col1<span class="token punctuation">;</span>
      <span class="token keyword">var</span> pos2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">b2Vec2</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x <span class="token operator">+</span> r <span class="token operator">*</span> ax<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y <span class="token operator">+</span> r <span class="token operator">*</span> ax<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      context<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>pos2<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos2<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token comment">// 绘制多边形</span>
    <span class="token keyword">case</span> b2Shape<span class="token punctuation">.</span>e_polyShape<span class="token operator">:</span>
      <span class="token keyword">var</span> poly <span class="token operator">=</span> shape<span class="token punctuation">;</span>
      <span class="token keyword">var</span> tV <span class="token operator">=</span> b2Math<span class="token punctuation">.</span><span class="token function">AddVV</span><span class="token punctuation">(</span>
        poly<span class="token punctuation">.</span>m_position<span class="token punctuation">,</span>
        b2Math<span class="token punctuation">.</span><span class="token function">b2MulMV</span><span class="token punctuation">(</span>poly<span class="token punctuation">.</span>m_R<span class="token punctuation">,</span> poly<span class="token punctuation">.</span>m_vertices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      context<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>tV<span class="token punctuation">.</span>x<span class="token punctuation">,</span> tV<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> poly<span class="token punctuation">.</span>m_vertexCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> v <span class="token operator">=</span> b2Math<span class="token punctuation">.</span><span class="token function">AddVV</span><span class="token punctuation">(</span>
          poly<span class="token punctuation">.</span>m_position<span class="token punctuation">,</span>
          b2Math<span class="token punctuation">.</span><span class="token function">b2MulMV</span><span class="token punctuation">(</span>poly<span class="token punctuation">.</span>m_R<span class="token punctuation">,</span> poly<span class="token punctuation">.</span>m_vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> v<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      context<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>tV<span class="token punctuation">.</span>x<span class="token punctuation">,</span> tV<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  context<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们也可以在其中一个刚体里将图片与刚体结合：</p>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token comment">//绘画功能</span>
<span class="token keyword">function</span> <span class="token function">drawWorld</span><span class="token punctuation">(</span><span class="token parameter">world<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> world<span class="token punctuation">.</span>m_jointList<span class="token punctuation">;</span> j<span class="token punctuation">;</span> j <span class="token operator">=</span> j<span class="token punctuation">.</span>m_next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 绘制关节</span>
    <span class="token comment">// drawJoint(j, context);</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> b <span class="token operator">=</span> world<span class="token punctuation">.</span>m_bodyList<span class="token punctuation">;</span> b <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> b <span class="token operator">=</span> b<span class="token punctuation">.</span>m_next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> s <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">GetShapeList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> s <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> s <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">GetNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">GetUserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 使用数据包括图片</span>
        <span class="token keyword">var</span> img <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">GetUserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 图片的长和宽</span>
        <span class="token keyword">var</span> x <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">GetPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>
        <span class="token keyword">var</span> y <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">GetPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
        <span class="token keyword">var</span> topleftX <span class="token operator">=</span> <span class="token operator">-</span>img<span class="token punctuation">.</span>clientWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> topleftY <span class="token operator">=</span> <span class="token operator">-</span>img<span class="token punctuation">.</span>clientHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>

        context<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">GetBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetRotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> topleftX<span class="token punctuation">,</span> topleftY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">drawShape</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="完整代码" tabindex="-1"><a class="header-anchor" href="#完整代码" aria-hidden="true">#</a> 完整代码</h2>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token keyword">var</span> canvas<span class="token punctuation">;</span>
<span class="token keyword">var</span> ctx<span class="token punctuation">;</span>
<span class="token keyword">var</span> canvasWidth<span class="token punctuation">;</span>
<span class="token keyword">var</span> canvasHeight<span class="token punctuation">;</span>

<span class="token keyword">var</span> world<span class="token punctuation">;</span>

<span class="token comment">// 我们将创建世界封装至createWorld函数内</span>
<span class="token keyword">function</span> <span class="token function">createWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 世界的大小</span>
  <span class="token keyword">var</span> worldAABB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">b2AABB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  worldAABB<span class="token punctuation">.</span>minVertex<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4000</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  worldAABB<span class="token punctuation">.</span>maxVertex<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">,</span> <span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//定义重力</span>
  <span class="token keyword">var</span> gravity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">b2Vec2</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 是否休眠</span>
  <span class="token keyword">var</span> doSleep <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token comment">// 最终创建世界</span>
  <span class="token keyword">var</span> world <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">b2World</span><span class="token punctuation">(</span>worldAABB<span class="token punctuation">,</span> gravity<span class="token punctuation">,</span> doSleep<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> world<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//绘画功能</span>
<span class="token keyword">function</span> <span class="token function">drawWorld</span><span class="token punctuation">(</span><span class="token parameter">world<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> world<span class="token punctuation">.</span>m_jointList<span class="token punctuation">;</span> j<span class="token punctuation">;</span> j <span class="token operator">=</span> j<span class="token punctuation">.</span>m_next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 绘制关节</span>
    <span class="token comment">// drawJoint(j, context);</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> b <span class="token operator">=</span> world<span class="token punctuation">.</span>m_bodyList<span class="token punctuation">;</span> b <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> b <span class="token operator">=</span> b<span class="token punctuation">.</span>m_next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> s <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">GetShapeList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> s <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> s <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">GetNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">GetUserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 使用数据包括图片</span>
        <span class="token keyword">var</span> img <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">GetUserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 图片的长和宽</span>
        <span class="token keyword">var</span> x <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">GetPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>
        <span class="token keyword">var</span> y <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">GetPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
        <span class="token keyword">var</span> topleftX <span class="token operator">=</span> <span class="token operator">-</span>img<span class="token punctuation">.</span>clientWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> topleftY <span class="token operator">=</span> <span class="token operator">-</span>img<span class="token punctuation">.</span>clientHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>

        context<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">GetBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetRotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> topleftX<span class="token punctuation">,</span> topleftY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">drawShape</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 创建圆形刚体</span>
<span class="token keyword">function</span> <span class="token function">createBall</span><span class="token punctuation">(</span><span class="token parameter">world<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 创建圆形定义</span>
  <span class="token keyword">var</span> ballSd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">b2CircleDef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ballSd<span class="token punctuation">.</span>density <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span> <span class="token comment">// 设置密度</span>
  ballSd<span class="token punctuation">.</span>radius <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// 设置半径</span>
  ballSd<span class="token punctuation">.</span>restitution <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span> <span class="token comment">// 设置弹性</span>
  ballSd<span class="token punctuation">.</span>friction <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 设置摩擦因子</span>
  <span class="token keyword">var</span> ballBd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">b2BodyDef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建刚体定义</span>
  ballBd<span class="token punctuation">.</span><span class="token function">AddShape</span><span class="token punctuation">(</span>ballSd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加形状</span>
  ballBd<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>x <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span> y <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置位置</span>
  <span class="token keyword">return</span> world<span class="token punctuation">.</span><span class="token function">CreateBody</span><span class="token punctuation">(</span>ballBd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建并返回刚体</span>
<span class="token punctuation">}</span>

<span class="token comment">// 创建矩形刚体</span>
<span class="token keyword">function</span> <span class="token function">createBox</span><span class="token punctuation">(</span><span class="token parameter">world<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> userData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> boxSd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">b2BoxDef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建一个形状Shape，然后设置有关Shape的属性</span>
  boxSd<span class="token punctuation">.</span>extents<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>width <span class="token operator">||</span> <span class="token number">1200</span><span class="token punctuation">,</span> height <span class="token operator">||</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置矩形高、宽</span>
  boxSd<span class="token punctuation">.</span>density <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
  boxSd<span class="token punctuation">.</span>userData <span class="token operator">=</span> userData<span class="token punctuation">;</span>
  boxSd<span class="token punctuation">.</span>restitution <span class="token operator">=</span> <span class="token number">0.3</span><span class="token punctuation">;</span> <span class="token comment">//设置矩形的弹性</span>
  boxSd<span class="token punctuation">.</span>friction <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//设置矩形的摩擦因子，可以设置为0-1之间任意一个数，0表示光滑，1表示强摩擦</span>

  <span class="token keyword">var</span> boxBd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">b2BodyDef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建刚体定义</span>
  boxBd<span class="token punctuation">.</span><span class="token function">AddShape</span><span class="token punctuation">(</span>boxSd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加形状</span>
  boxBd<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>x <span class="token operator">||</span> <span class="token number">10</span><span class="token punctuation">,</span> y <span class="token operator">||</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置位置</span>
  <span class="token keyword">return</span> world<span class="token punctuation">.</span><span class="token function">CreateBody</span><span class="token punctuation">(</span>boxBd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建并返回刚体</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定义step函数，用于游戏的迭代运行</span>
<span class="token keyword">function</span> <span class="token function">step</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 模拟世界</span>
  world<span class="token punctuation">.</span><span class="token function">Step</span><span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 清除画布</span>
  ctx<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvasWidth<span class="token punctuation">,</span> canvasHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 重新绘制</span>
  <span class="token function">drawWorld</span><span class="token punctuation">(</span>world<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 再次刷新</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span>step<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"step..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 从draw_world.js里面引用的绘画功能</span>
<span class="token keyword">function</span> <span class="token function">drawShape</span><span class="token punctuation">(</span><span class="token parameter">shape<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  context<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">"#003300"</span><span class="token punctuation">;</span>
  context<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>shape<span class="token punctuation">.</span>m_type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 绘制圆</span>
    <span class="token keyword">case</span> b2Shape<span class="token punctuation">.</span>e_circleShape<span class="token operator">:</span>
      <span class="token keyword">var</span> circle <span class="token operator">=</span> shape<span class="token punctuation">;</span>
      <span class="token keyword">var</span> pos <span class="token operator">=</span> circle<span class="token punctuation">.</span>m_position<span class="token punctuation">;</span>
      <span class="token keyword">var</span> r <span class="token operator">=</span> circle<span class="token punctuation">.</span>m_radius<span class="token punctuation">;</span>
      <span class="token keyword">var</span> segments <span class="token operator">=</span> <span class="token number">16.0</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> theta <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> dtheta <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2.0</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">/</span> segments<span class="token punctuation">;</span>
      <span class="token comment">// 画圆圈</span>
      context<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x <span class="token operator">+</span> r<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> segments<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">b2Vec2</span><span class="token punctuation">(</span>r <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>theta<span class="token punctuation">)</span><span class="token punctuation">,</span> r <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>theta<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> v <span class="token operator">=</span> b2Math<span class="token punctuation">.</span><span class="token function">AddVV</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> v<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        theta <span class="token operator">+=</span> dtheta<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      context<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x <span class="token operator">+</span> r<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 画半径</span>
      context<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> ax <span class="token operator">=</span> circle<span class="token punctuation">.</span>m_R<span class="token punctuation">.</span>col1<span class="token punctuation">;</span>
      <span class="token keyword">var</span> pos2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">b2Vec2</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x <span class="token operator">+</span> r <span class="token operator">*</span> ax<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y <span class="token operator">+</span> r <span class="token operator">*</span> ax<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      context<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>pos2<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos2<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token comment">// 绘制多边形</span>
    <span class="token keyword">case</span> b2Shape<span class="token punctuation">.</span>e_polyShape<span class="token operator">:</span>
      <span class="token keyword">var</span> poly <span class="token operator">=</span> shape<span class="token punctuation">;</span>
      <span class="token keyword">var</span> tV <span class="token operator">=</span> b2Math<span class="token punctuation">.</span><span class="token function">AddVV</span><span class="token punctuation">(</span>
        poly<span class="token punctuation">.</span>m_position<span class="token punctuation">,</span>
        b2Math<span class="token punctuation">.</span><span class="token function">b2MulMV</span><span class="token punctuation">(</span>poly<span class="token punctuation">.</span>m_R<span class="token punctuation">,</span> poly<span class="token punctuation">.</span>m_vertices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      context<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>tV<span class="token punctuation">.</span>x<span class="token punctuation">,</span> tV<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> poly<span class="token punctuation">.</span>m_vertexCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> v <span class="token operator">=</span> b2Math<span class="token punctuation">.</span><span class="token function">AddVV</span><span class="token punctuation">(</span>
          poly<span class="token punctuation">.</span>m_position<span class="token punctuation">,</span>
          b2Math<span class="token punctuation">.</span><span class="token function">b2MulMV</span><span class="token punctuation">(</span>poly<span class="token punctuation">.</span>m_R<span class="token punctuation">,</span> poly<span class="token punctuation">.</span>m_vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> v<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      context<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>tV<span class="token punctuation">.</span>x<span class="token punctuation">,</span> tV<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  context<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"canvas"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">"2d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvasWidth <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvasHeight <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 启动游戏</span>
  world <span class="token operator">=</span> <span class="token function">createWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> ball1 <span class="token operator">=</span> <span class="token function">createBall</span><span class="token punctuation">(</span>world<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> ball2 <span class="token operator">=</span> <span class="token function">createBall</span><span class="token punctuation">(</span>world<span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> box1 <span class="token operator">=</span> <span class="token function">createBox</span><span class="token punctuation">(</span>world<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> box2 <span class="token operator">=</span> <span class="token function">createBox</span><span class="token punctuation">(</span>world<span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"box"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">step</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://github.com/godbasin/box2djs-tutorial/tree/master/6-practice/6-2-add-body/6-2-add-body" target="_blank" rel="noopener noreferrer">此处查看项目代码（仅包含 src 部分）<ExternalLinkIcon/></a><br>
<a href="http://box2d-tutorial.godbasin.com/6-2-add-body/index.html" target="_blank" rel="noopener noreferrer">此处查看页面效果<ExternalLinkIcon/></a></p>
</div></template>


